<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; text-align: center; padding: 40px; }
    h1 { margin-bottom: 30px; }
    .menu { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 520px; margin: 0 auto; }
    button {
      padding: 16px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #0d6efd;
      color: #fff;
      transition: 0.2s;
    }
    button:hover { background: #0b5ed7; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .hidden { display: none; }
    .panel { border: 1px solid #ccc; padding: 20px; margin-top: 20px; max-width: 560px; margin-left: auto; margin-right: auto; text-align: left; border-radius: 10px; }
    .price { font-size: 20px; margin: 10px 0; }
    .timer { font-weight: bold; color: #d90429; margin: 10px 0; }
    .winner { font-weight: bold; color: #2b9348; margin-top: 15px; }
    input { padding: 10px; font-size: 14px; width: 100%; box-sizing: border-box; margin-top: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .actions { display: flex; gap: 10px; margin-top: 12px; }
    ul { margin-top: 15px; padding-left: 20px; }
    li { margin-bottom: 6px; }
  </style>
</head>
<body>
  <h1>ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ </h1>

  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="menu" class="menu">
    <button onclick="showPanel('normalBid')">ğŸ’° é€šå¸¸ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­</button>
    <button onclick="showPanel('reverseBid')">ğŸ’° é€†ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­</button>
  </div>

  <!-- é€šå¸¸ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­ -->
  <section id="normalBid" class="panel hidden">
    <h2>é€šå¸¸ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­ç”»é¢</h2>
    <div>å•†å“å: ã‚µãƒ³ãƒ—ãƒ«å•†å“</div>
    <div class="price">ç¾åœ¨ä¾¡æ ¼: <span id="currentPrice">5000</span> å††</div>
    <div class="timer">æ®‹ã‚Šæ™‚é–“: <span id="normalTimer">60</span> ç§’</div>

    <input id="bidderName" type="text" placeholder="å…¥æœ­è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
    <div class="actions">
      <button id="normalBidBtn" onclick="placeBid()">å…¥æœ­ã™ã‚‹</button>
      <button onclick="backToMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>

    <h3>å…¥æœ­å±¥æ­´</h3>
    <ul id="bidHistory"></ul>

    <div id="normalWinner" class="winner"></div>
  </section>

  <!-- é€†ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­ -->
  <section id="reverseBid" class="panel hidden">
    <h2>é€†ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å…¥æœ­ç”»é¢</h2>
    <div>æ¡ˆä»¶: ã‚µãƒ³ãƒ—ãƒ«æ¡ˆä»¶ï¼ˆå¸Œæœ›ä¾¡æ ¼ 10,000 å††ä»¥ä¸‹ï¼‰</div>
    <div class="price">ç¾åœ¨ã®æœ€å®‰å€¤: <span id="lowestPrice">æœªå…¥æœ­</span></div>
    <div class="timer">æ®‹ã‚Šæ™‚é–“: <span id="reverseTimer">60</span> ç§’</div>

    <input id="reverseBidderName" type="text" placeholder="å…¥æœ­è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
    <input id="reverseBidAmount" type="number" min="1" placeholder="æç¤ºä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
    <div class="actions">
      <button id="reverseBidBtn" onclick="placeReverseBid()">å…¥æœ­ã™ã‚‹</button>
      <button onclick="backToMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>

    <h3>å…¥æœ­å±¥æ­´</h3>
    <ul id="reverseBidHistory"></ul>

    <div id="reverseWinner" class="winner"></div>
  </section>

  <script>
    // ===== é€šå¸¸ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ =====
    let currentPrice = 5000;
    const bidStep = 500;
    let normalTimerInterval = null;
    const normalHistoryEl = document.getElementById("bidHistory");
    let normalBids = []; // { bidder, price, time }

    function placeBid() {
      const nameInput = document.getElementById("bidderName");
      const bidder = nameInput.value.trim();
      if (!bidder) { alert("å…¥æœ­è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      if (document.getElementById("normalBidBtn").disabled) { return; }

      currentPrice += bidStep;
      document.getElementById("currentPrice").textContent = currentPrice.toLocaleString();

      const now = new Date().toLocaleTimeString();
      normalBids.push({ bidder, price: currentPrice, time: now });

      const li = document.createElement("li");
      li.textContent = `${now} - ${bidder} ã•ã‚“ãŒ Â¥${currentPrice.toLocaleString()} ã§å…¥æœ­`;
      normalHistoryEl.prepend(li);

      nameInput.value = "";
      nameInput.focus();
    }

    function declareNormalWinner() {
      const winnerEl = document.getElementById("normalWinner");
      if (normalBids.length === 0) {
        winnerEl.textContent = "å…¥æœ­è€…ãªã— â†’ è½æœ­è€…ãªã—";
      } else {
        const last = normalBids[normalBids.length - 1]; // æœ€é«˜å€¤ã¯æœ€å¾Œã®å…¥æœ­
        winnerEl.textContent = `è½æœ­è€…: ${last.bidder} ã•ã‚“ï¼ˆÂ¥${last.price.toLocaleString()}ï¼‰`;
      }
      alert("é€šå¸¸ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã¯çµ‚äº†ã—ã¾ã—ãŸ");
    }

    function startNormalTimer(seconds) {
      clearInterval(normalTimerInterval);
      let timeLeft = seconds;
      document.getElementById("normalTimer").textContent = timeLeft;
      document.getElementById("normalBidBtn").disabled = false;
      document.getElementById("normalWinner").textContent = "";

      normalTimerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("normalTimer").textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(normalTimerInterval);
          document.getElementById("normalBidBtn").disabled = true;
          declareNormalWinner();
        }
      }, 1000);
    }

    // ===== é€†ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ =====
    let lowestPrice = null;
    let reverseTimerInterval = null;
    const reverseHistoryEl = document.getElementById("reverseBidHistory");
    let reverseBids = []; // { bidder, price, time }

    function placeReverseBid() {
      const nameInput = document.getElementById("reverseBidderName");
      const bidder = nameInput.value.trim();
      const amountInput = document.getElementById("reverseBidAmount");
      const bidAmount = parseInt(amountInput.value, 10);

      if (!bidder || !bidAmount || bidAmount <= 0) {
        alert("å…¥æœ­è€…åã¨æ­£ã—ã„æç¤ºä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }
      if (document.getElementById("reverseBidBtn").disabled) { return; }

      const now = new Date().toLocaleTimeString();
      reverseBids.push({ bidder, price: bidAmount, time: now });

      if (lowestPrice === null || bidAmount < lowestPrice) {
        lowestPrice = bidAmount;
        document.getElementById("lowestPrice").textContent = `Â¥${lowestPrice.toLocaleString()}`;
      }

      const li = document.createElement("li");
      li.textContent = `${now} - ${bidder} ã•ã‚“ãŒ Â¥${bidAmount.toLocaleString()} ã‚’æç¤º`;
      reverseHistoryEl.prepend(li);

      nameInput.value = "";
      amountInput.value = "";
      nameInput.focus();
    }

    function declareReverseWinner() {
      const winnerEl = document.getElementById("reverseWinner");
      if (reverseBids.length === 0) {
        winnerEl.textContent = "å…¥æœ­è€…ãªã— â†’ è½æœ­è€…ãªã—";
      } else {
        let winner = reverseBids[0];
        for (const b of reverseBids) {
          if (b.price < winner.price) winner = b;
        }
        winnerEl.textContent = `è½æœ­è€…: ${winner.bidder} ã•ã‚“ï¼ˆÂ¥${winner.price.toLocaleString()}ï¼‰`;
      }
      alert("é€†ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã¯çµ‚äº†ã—ã¾ã—ãŸ");
    }

    function startReverseTimer(seconds) {
      clearInterval(reverseTimerInterval);
      let timeLeft = seconds;
      document.getElementById("reverseTimer").textContent = timeLeft;
      document.getElementById("reverseBidBtn").disabled = false;
      document.getElementById("reverseWinner").textContent = "";

      reverseTimerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("reverseTimer").textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(reverseTimerInterval);
          document.getElementById("reverseBidBtn").disabled = true;
          declareReverseWinner();
        }
      }, 1000);
    }

    // ===== ç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼†ãƒªã‚»ãƒƒãƒˆ =====
    function showPanel(id) {
      document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
      document.getElementById("menu").classList.add("hidden");
      document.getElementById(id).classList.remove("hidden");

      if (id === "normalBid") startNormalTimer(60);
      if (id === "reverseBid") startReverseTimer(60);
    }

    function backToMenu() {
      // ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
      document.getElementById("menu").classList.remove("hidden");

      // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
      clearInterval(normalTimerInterval);
      clearInterval(reverseTimerInterval);

      // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆï¼ˆç”»é¢ã¨å†…éƒ¨ï¼‰
      normalBids = [];
      reverseBids = [];
      currentPrice = 5000;
      lowestPrice = null;

      document.getElementById("currentPrice").textContent = "5000";
      document.getElementById("lowestPrice").textContent = "æœªå…¥æœ­";
      document.getElementById("normalTimer").textContent = "60";
      document.getElementById("reverseTimer").textContent = "60";
      document.getElementById("normalBidBtn").disabled = false;
      document.getElementById("reverseBidBtn").disabled = false;
      document.getElementById("normalWinner").textContent = "";
      document.getElementById("reverseWinner").textContent = "";
      normalHistoryEl.innerHTML = "";
      reverseHistoryEl.innerHTML = "";
      document.getElementById("bidderName").value = "";
      document.getElementById("reverseBidderName").value = "";
      document.getElementById("reverseBidAmount").value = "";
    }
  </script>
</body>
</html>
